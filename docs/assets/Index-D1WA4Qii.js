var S=Object.defineProperty;var E=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>(E(r,typeof e!="symbol"?e+"":e,t),t);import{r as p,o as O,w as R,a as I,b as g,c as y,d as o,n as D,F as M,e as w,t as f,f as N,p as _,g as T}from"./index-TksbKGz4.js";class k{constructor(e,t){i(this,"size");i(this,"bgColor");this.size=e,this.bgColor=t}}class G{constructor(e,t,s,h,a){i(this,"row");i(this,"column");i(this,"cells");i(this,"cellSize");i(this,"cellGap");i(this,"cellBgColor");i(this,"notEmptyCellNum");i(this,"food");i(this,"snake");this.row=e,this.column=t,this.cellSize=s,this.cellGap=h,this.cellBgColor=a,this.notEmptyCellNum=0,this.cells=[];for(let c=0;c<this.row;c++){const n=[];for(let l=0;l<this.column;l++)n.push(new k(this.cellSize,a));this.cells.push(n)}}addFood(e){this.food=e,this.notEmptyCellNum++}addSnake(e){this.snake=e,this.notEmptyCellNum++}setCellBgColor(e,t,s){e<0||e>=this.row||t<0||t>=this.column||(this.cells[e][t].bgColor=s)}renderFood(){this.setCellBgColor(this.food.x,this.food.y,this.food.bgColor)}renderSnake(){this.setCellBgColor(this.snake.head.x,this.snake.head.y,this.snake.head.bgColor),this.snake.bodys.forEach(e=>{this.setCellBgColor(e.x,e.y,e.bgColor)})}clearSnakeTail(){if(this.snake.bodys.length===0){this.setCellBgColor(this.snake.head.x,this.snake.head.y,this.cellBgColor);return}const e=this.snake.bodys[this.snake.bodys.length-1];this.setCellBgColor(e.x,e.y,this.cellBgColor)}clearSelf(){for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++)this.setCellBgColor(e,t,this.cellBgColor);this.notEmptyCellNum=0}}const m=(r,e)=>Math.floor(Math.random()*(e-r+1))+r;class B extends k{constructor(t,s,h){super(t.cellSize,s);i(this,"x");i(this,"y");i(this,"score");i(this,"gameMap");this.x=m(0,t.row-1),this.y=m(0,t.column-1);const a=t.snake.head;for(;this.x===a.x&&this.y===a.y;)this.x=m(0,t.row-1),this.y=m(0,t.column-1);this.score=h,this.gameMap=t}reGenerate(){const t=this.gameMap.row*this.gameMap.column;this.gameMap.notEmptyCellNum>t/2?this.indirectGenerate():this.directGenerate()}setScore(t){this.score=t}indirectGenerate(){const t=[];if(t.push({x:this.gameMap.snake.head.x,y:this.gameMap.snake.head.y}),this.gameMap.snake.bodys.length>0)for(let c=0;c<this.gameMap.snake.bodys.length;c++)t.push({x:this.gameMap.snake.bodys[c].x,y:this.gameMap.snake.bodys[c].y});const s=[];for(let c=0;c<this.gameMap.row;c++)for(let n=0;n<this.gameMap.column;n++){let l=!0;for(let u=0;u<t.length;u++)if(c===t[u].x&&n===t[u].y){l=!1;break}l&&s.push({x:c,y:n})}if(s.length===0){this.gameMap.snake.isDead=!0;return}const h=m(0,s.length-1),a=s[h];this.occupyRender(a.x,a.y)}directGenerate(){const t=this.gameMap.snake;let s=m(0,this.gameMap.row-1),h=m(0,this.gameMap.column-1);for(;t.bodys.some(a=>s===a.x&&h===a.y)||s===t.head.x&&h===t.head.y;)s=m(0,this.gameMap.row-1),h=m(0,this.gameMap.column-1);this.occupyRender(s,h)}occupyRender(t,s){this.x=t,this.y=s,this.gameMap.notEmptyCellNum++,this.gameMap.renderFood()}}class L extends k{constructor(t,s){super(t.cellSize,s);i(this,"x");i(this,"y");this.x=m(0,t.row-1),this.y=m(0,t.column-1)}reset(t,s){this.x=t,this.y=s}}class F extends k{constructor(t,s,h,a){super(t.cellSize,a);i(this,"x");i(this,"y");this.x=s,this.y=h}}const d=class d{constructor(e,t,s,h,a){i(this,"head");i(this,"bodys");i(this,"bodyColor");i(this,"moveDirection");i(this,"lastDirectionChange");i(this,"directionLockTime");i(this,"isDead");i(this,"moveSpeed");i(this,"gameRecorder");i(this,"gameMap");this.head=new L(t,s),this.bodys=[],this.bodyColor=h,this.moveDirection=m(0,Object.keys(d.MOVE_DIRECTION).length-1),this.lastDirectionChange=0,this.directionLockTime=Math.floor(a/10*6),this.isDead=!1,this.moveSpeed=a,this.gameRecorder=e,this.gameMap=t}turnLeft(){const e=Date.now();e-this.lastDirectionChange<this.directionLockTime||this.moveDirection!==d.MOVE_DIRECTION.RIGHT&&(this.moveDirection=d.MOVE_DIRECTION.LEFT,this.lastDirectionChange=e)}turnRight(){const e=Date.now();e-this.lastDirectionChange<this.directionLockTime||this.moveDirection!==d.MOVE_DIRECTION.LEFT&&(this.moveDirection=d.MOVE_DIRECTION.RIGHT,this.lastDirectionChange=e)}turnUp(){const e=Date.now();e-this.lastDirectionChange<this.directionLockTime||this.moveDirection!==d.MOVE_DIRECTION.DOWN&&(this.moveDirection=d.MOVE_DIRECTION.UP,this.lastDirectionChange=e)}turnDown(){const e=Date.now();e-this.lastDirectionChange<this.directionLockTime||this.moveDirection!==d.MOVE_DIRECTION.UP&&(this.moveDirection=d.MOVE_DIRECTION.DOWN,this.lastDirectionChange=e)}move(){if(!this.isDead)switch(this.moveDirection){case d.MOVE_DIRECTION.UP:this.moveUp();break;case d.MOVE_DIRECTION.DOWN:this.moveDown();break;case d.MOVE_DIRECTION.LEFT:this.moveLeft();break;case d.MOVE_DIRECTION.RIGHT:this.moveRight();break}}moveUp(){if(this.head.x===0||this.mayEatSelf(this.head.x-1,this.head.y)){this.isDead=!0;return}const e=this.bodys.length===0?JSON.parse(JSON.stringify(this.head)):JSON.parse(JSON.stringify(this.bodys[this.bodys.length-1]));this.moveBody(),this.head.x--,this.mayEatFood(e)}moveDown(){if(this.head.x===this.gameMap.row-1||this.mayEatSelf(this.head.x+1,this.head.y)){this.isDead=!0;return}const e=this.bodys.length===0?JSON.parse(JSON.stringify(this.head)):JSON.parse(JSON.stringify(this.bodys[this.bodys.length-1]));this.moveBody(),this.head.x++,this.mayEatFood(e)}moveLeft(){if(this.head.y===0||this.mayEatSelf(this.head.x,this.head.y-1)){this.isDead=!0;return}const e=this.bodys.length===0?JSON.parse(JSON.stringify(this.head)):JSON.parse(JSON.stringify(this.bodys[this.bodys.length-1]));this.moveBody(),this.head.y--,this.mayEatFood(e)}moveRight(){if(this.head.y===this.gameMap.column-1||this.mayEatSelf(this.head.x,this.head.y+1)){this.isDead=!0;return}const e=this.bodys.length===0?JSON.parse(JSON.stringify(this.head)):JSON.parse(JSON.stringify(this.bodys[this.bodys.length-1]));this.moveBody(),this.head.y++,this.mayEatFood(e)}moveBody(){if(this.bodys.length!==0){for(let e=this.bodys.length-1;e>=1;e--)this.bodys[e].x=this.bodys[e-1].x,this.bodys[e].y=this.bodys[e-1].y;this.bodys[0].x=this.head.x,this.bodys[0].y=this.head.y}}mayEatSelf(e,t){for(let s=0;s<this.bodys.length;s++)if(e===this.bodys[s].x&&t===this.bodys[s].y)return!0;return!1}mayEatFood(e){this.head.x===this.gameMap.food.x&&this.head.y===this.gameMap.food.y&&(this.bodys.push(new F(this.gameMap,e.x,e.y,this.bodyColor)),this.gameRecorder.addScore(this.gameMap.food.score),this.gameRecorder.addEated(),this.gameMap.food.reGenerate(),this.gameMap.food.setScore(this.gameRecorder.nextScore()))}reborn(){this.bodys.splice(0,this.bodys.length);const e=m(0,this.gameMap.row-1),t=m(0,this.gameMap.column-1);this.head.reset(e,t),this.isDead=!1}};i(d,"MOVE_DIRECTION",{UP:0,DOWN:1,LEFT:2,RIGHT:3});let b=d;class J{constructor(e,t){i(this,"gameRecorder");i(this,"gameMap");i(this,"isGameRunning");i(this,"timer");this.gameRecorder=e,this.gameMap=t,this.isGameRunning=!1,this.timer=null}autoMoveSnake(){this.isGameRunning=!0,this.timer=setInterval(()=>{if(this.gameMap.snake.isDead){this.pauseGame();return}this.gameMap.clearSnakeTail(),this.gameMap.snake.move(),this.gameMap.renderSnake()},this.gameMap.snake.moveSpeed)}listenKeyboard(){return e=>{switch(e.preventDefault(),e.key){case"ArrowUp":this.gameMap.snake.turnUp();break;case"ArrowDown":this.gameMap.snake.turnDown();break;case"ArrowLeft":this.gameMap.snake.turnLeft();break;case"ArrowRight":this.gameMap.snake.turnRight();break;case"Enter":this.pauseGame();break;case"r":this.resetGame();break}}}pauseGame(){this.gameMap.snake.isDead||(this.isGameRunning?(this.isGameRunning=!1,this.clearTimer()):this.autoMoveSnake())}resetGame(){this.gameRecorder.reset(),this.gameMap.clearSelf(),this.gameMap.snake.reborn(),this.gameMap.snake.isDead=!1,this.gameMap.renderSnake(),this.gameMap.food.reGenerate(),this.clearTimer(),this.autoMoveSnake()}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}}class V{constructor(){i(this,"score");i(this,"level");i(this,"eated");i(this,"record");this.score=0,this.level=1,this.eated=0,this.loadRecord()}addScore(e){this.score+=e}addEated(){this.eated++,this.mayIncreaseLevel()}mayIncreaseLevel(){this.eated%5===0&&this.level++}nextScore(){return this.eated*(this.eated+1)/2*this.level}mayBreakRecord(){this.score>this.record&&(this.record=this.score,localStorage.setItem("record",this.record))}loadRecord(){const e=localStorage.getItem("record");e?this.record=parseFloat(e):this.record=0}reset(){this.score=0,this.level=1,this.eated=0}}const z=(r,e)=>{const t=r.__vccOpts||r;for(const[s,h]of e)t[s]=h;return t},v=r=>(_("data-v-06a3e367"),r=r(),T(),r),U={class:"game-container"},H={class:"game-left"},j={key:0,class:"game-over"},A={class:"operation-box"},P={class:"game-right"},W={class:"data-box"},$={class:"data-row"},K=v(()=>o("div",{class:"data-label"},"已吃食物:",-1)),X={class:"data"},Y={class:"data-row"},q=v(()=>o("div",{class:"data-label"},"等级:",-1)),Q={class:"data"},Z={class:"data-row"},ee=v(()=>o("div",{class:"data-label"},"分数:",-1)),te={class:"data"},se={class:"data-row"},ie=v(()=>o("div",{class:"data-label"},"速度:",-1)),ae={class:"data"},oe={class:"data-row"},re=v(()=>o("div",{class:"data-label"},"历史记录:",-1)),ne={class:"data"},he={class:"system-box"},le={__name:"Index",setup(r){const e=p(new G(20,10,20,1,"#eee")),t=p(new V),s=p(new b(t,e,"yellow","green",500));e.addSnake(s);const h=p(new B(e,"red",1));e.addFood(h),e.renderSnake(),e.renderFood();const a=p(new J(t,e));return a.autoMoveSnake(),O(()=>{window.addEventListener("keydown",a.listenKeyboard()),R(()=>s.isDead,c=>{c&&t.mayBreakRecord()})}),I(()=>{window.removeEventListener("keydown",a.listenKeyboard())}),(c,n)=>(g(),y("div",U,[o("div",H,[o("div",{class:"main-frame",style:D({"--cell-gap":e.cellGap+"px"})},[(g(!0),y(M,null,w(e.cells,(l,u)=>(g(),y("div",{key:u,class:"row"},[(g(!0),y(M,null,w(l,(C,x)=>(g(),y("div",{key:x,class:"cell",style:D({background:C.bgColor,"--cell-size":C.size+"px"})},null,4))),128)),s.isDead?(g(),y("div",j,"Game Over")):N("",!0)]))),128))],4),o("div",A,[o("div",{class:"btn move-up",onClick:n[0]||(n[0]=l=>s.turnUp())},"向上"),o("div",{class:"btn",onClick:n[1]||(n[1]=l=>s.turnLeft())},"向左"),o("div",{class:"btn",onClick:n[2]||(n[2]=l=>s.turnRight())},"向右"),o("div",{class:"btn move-down",onClick:n[3]||(n[3]=l=>s.turnDown())},"向下")])]),o("div",P,[o("div",W,[o("div",$,[K,o("div",X,f(t.eated),1)]),o("div",Y,[q,o("div",Q,f(t.level),1)]),o("div",Z,[ee,o("div",te,f(t.score),1)]),o("div",se,[ie,o("div",ae,f(s.moveSpeed),1)]),o("div",oe,[re,o("div",ne,f(t.record),1)])]),o("div",he,[a.isGameRunning?(g(),y("div",{key:0,class:"btn",onClick:n[4]||(n[4]=(...l)=>a.pauseGame&&a.pauseGame(...l))}," 暂停 ")):(g(),y("div",{key:1,class:"btn",onClick:n[5]||(n[5]=(...l)=>a.pauseGame&&a.pauseGame(...l))}," 继续 ")),o("div",{class:"btn",onClick:n[6]||(n[6]=(...l)=>a.resetGame&&a.resetGame(...l))},"重新开始")])])]))}},me=z(le,[["__scopeId","data-v-06a3e367"]]);export{me as default};
